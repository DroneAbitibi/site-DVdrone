<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Drone Abitibi – Démonstration photogrammétrie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  >

  <link rel="stylesheet" href="assets/styles.css">
</head>
<body class="page-shell">
  <header class="site-header frame">
    <a class="brand" aria-label="DV Drone" href="accueil.html">
      <div class="logo" aria-hidden>DV</div>
      <div>DV Drone <span style="font-weight:500;color:var(--muted)">· Imagerie aérienne</span></div>
    </a>
    <nav class="nav-links" aria-label="Navigation principale">
      <a class="pill" href="accueil.html#services">Services</a>
      <a class="pill" href="photos-aeriennes.html">Portfolio</a>
      <a class="pill" href="demo-photogrammetrie.html">Photogrammétrie</a>
      <a class="pill" href="accueil.html#contact">Contact</a>
    </nav>
  </header>
  <main class="page">
        <section class="hero-banner hero-photogrammetry" aria-label="Introduction de la page">
      <div class="hero-content">
        <span class="eyebrow">Photogrammétrie</span>
        <h1>Démonstration de couches cartographiques</h1>
        <p class="lead">
          Cette carte interactive superpose plusieurs couches issues d’une même mission de photogrammétrie : orthophoto, modèles numériques de terrain (DTM) et de surface (DSM).
        </p>
      </div>
    </section>

    <div class="content-grid">
      <!-- Carte -->
      <div id="map"></div>

      <!-- Panneau explicatif -->
      <aside class="side-panel">
        <h2>Couches disponibles</h2>
        <p>Chaque couche illustre un aspect différent de la même zone :</p>
        <ul class="layer-list">
          <li>
            <span class="chip">Base</span>
            <strong>Orthophoto</strong> – mosaïque d’images aériennes géoréférencées.
          </li>
          <li>
            <span class="chip">DTM</span>
            <strong>Modèle numérique de terrain</strong> – altitude du sol nu (végétation et bâtiments retirés).
          </li>
          <li>
            <span class="chip">DSM</span>
            <strong>Modèle numérique de surface</strong> – altitude incluant bâtiments, arbres, structures.
          </li>
        </ul>

        <p class="note">
          Cette page est fournie à titre de démonstration. Les couches et résolutions
          peuvent être adaptées selon les besoins d’un projet précis (survol, volume,
          suivi de chantier, etc.).
        </p>
      </aside>
    </div>

    <section class="source-section" aria-label="Images sources de l'orthophoto">
      <h2>Images sources utilisées pour l'orthophoto</h2>
      <p class="lead">
        Un échantillon de trois clichés nadir (sur les 64 capturés) montrant la zone survolée. Ils illustrent les conditions
        lumineuses et le niveau de détail qui servent ensuite au traitement photogrammétrique.
      </p>
      <div class="source-grid">
        <figure class="source-card">
          <img src="photos/source-1.jpg" alt="Image source aérienne 1 servant à l'orthophoto" loading="lazy">
          <figcaption>Source 1 — Vue de la zone survolée</figcaption>
        </figure>
        <figure class="source-card">
          <img src="photos/source-2.jpg" alt="Image source aérienne 2 servant à l'orthophoto" loading="lazy">
          <figcaption>Source 2 — Détails au-dessus du centre du site</figcaption>
        </figure>
        <figure class="source-card">
          <img src="photos/source-3.jpg" alt="Image source aérienne 3 servant à l'orthophoto" loading="lazy">
          <figcaption>Source 3 — Angle complémentaire pour la mosaïque</figcaption>
        </figure>
      </div>
    </section>

    <section class="report">
      <h2>Résumé du traitement photogrammétrique</h2>
      <p class="lead">
        Présentation simplifiée des données de vol pour une lecture rapide par le public.
        Les valeurs proviennent du même traitement <strong>OpenDroneMap 3.5.6</strong>
        ayant servi à produire les couches affichées sur la carte.
      </p>

      <div class="report-grid">
        <div class="report-card">
          <p class="eyebrow">Mission</p>
          <h3>Vol du 29 août 2025</h3>
          <ul>
            <li>Décollage 09:34, atterrissage 09:40 (6 min 27 s).</li>
            <li>Traitement réalisé le 1<sup>er</sup> septembre avec <strong>OpenDroneMap 3.5.6</strong>.</li>
          </ul>
        </div>
        <div class="report-card">
          <p class="eyebrow">Zone couverte</p>
          <h3>Environ 5 hectares</h3>
          <ul>
            <li>62 photos utilisées sur 64 (97&nbsp;%).</li>
            <li>17&nbsp;782 points reconstruits sur 18&nbsp;283 (97&nbsp;%).</li>
            <li>GSD moyen de <strong>4,2&nbsp;cm/pixel</strong> pour la netteté.</li>
          </ul>
        </div>
        <div class="report-card">
          <p class="eyebrow">Positionnement</p>
          <h3>Référencé par GPS</h3>
          <ul>
            <li>Erreur GPS moyenne : 1,42&nbsp;m.</li>
            <li>Précision estimée : CE90 <strong>2,17&nbsp;m</strong>, LE90 <strong>0,97&nbsp;m</strong>.</li>
          </ul>
        </div>
        <div class="report-card">
          <p class="eyebrow">Qualité 3D</p>
          <h3>Ajustement des points</h3>
          <ul>
            <li>RMS : X 0,14&nbsp;m, Y 0,12&nbsp;m, Z 0,39&nbsp;m.</li>
            <li>Modèle caméra : DJI FC9113 (4096×3072).</li>
          </ul>
        </div>
      </div>

      <small>
        Étapes clés : capture des clichés, repérage des points communs, calcul du nuage de
        points, ajustement 3D, génération des modèles de terrain et de surface, puis
        création des tuiles d’orthophoto pour la carte. Ces indicateurs permettent de
        vérifier rapidement la qualité du vol et des produits.
      </small>
    </section>
    <a href="accueil.html" class="back-link">← Retour à l'accueil</a>
  </main>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
  </script>

  <script>
    // --- Initialisation de la carte ---
    // Centre de ta zone
    var centerLat = 48.36437985117837;
    var centerLng = -79.12920231790572;
    
    // Bornes d’un carré d’environ 2 km x 2 km autour du centre
    var bounds = L.latLngBounds(
      [48.35539673942846, -79.14272313921768], // sud, ouest
      [48.37336296292828, -79.11568149659377]  // nord, est
    );
    
    var map = L.map('map', {
      center: [centerLat, centerLng],
      zoom: 16,              // à ajuster selon le niveau de détail souhaité
      minZoom: 15,           // pour éviter de trop dézoomer
      maxZoom: 21,           // adapté à tes tuiles z=19
      maxBounds: bounds,     // limite le déplacement à ce carré
      maxBoundsViscosity: 1  // effet “élastique” aux limites (1 = bloqué net)
    });

    var esriImagery = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      {
        maxZoom: 20,
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Maxar, Earthstar Geographics'
      }
    ).addTo(map); // <-- ACTIVÉ PAR DÉFAUT

    var osm = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }
    );
    // --- Couches de base / overlays ---
    // 1) Orthophoto (base)
    // Source tuile orthophoto
    var orthophoto = L.tileLayer(
      'https://dvdrone-datasets.s3.ca-central-1.amazonaws.com/test001/tiles_ortho/{z}/{x}/{y}.png',
      {
        minZoom: 15,
        maxZoom: 22,
        tms: true,      // IMPORTANT : gdal2tiles = TMS -> Y inversé
        attribution: '&copy; DV Drone - Orthophoto',
      }
    ).addTo(map);

    // 2) DTM (MNT) – souvent visualisé en ombrage (hillshade) ou palette de couleurs
    var dtm = L.tileLayer(
      'https://dvdrone-datasets.s3.ca-central-1.amazonaws.com/test001/tiles_dtm/{z}/{x}/{y}.png',
      {
        minZoom: 15,
        maxZoom: 22,
        tms: true,      // IMPORTANT : gdal2tiles = TMS -> Y inversé
        attribution: '&copy; DV Drone – DTM',
      }
    );

    // 3) DSM – modèle numérique de surface
    var dsm = L.tileLayer(
      'https://dvdrone-datasets.s3.ca-central-1.amazonaws.com/test001/tiles_dsm/{z}/{x}/{y}.png',
      {
        minZoom: 15,
        maxZoom: 22,
        tms: true,      // IMPORTANT : gdal2tiles = TMS -> Y inversé
        attribution: '&copy; DV Drone – DSM',
      }
    );
    
    // Si tu as un service WMS pour les courbes, ce serait plutôt:
    /*
    var contours = L.tileLayer.wms('https://example.com/geoserver/wms', {
      layers: 'mon_workspace:contours',
      format: 'image/png',
      transparent: true,
      attribution: '&copy; Courbes de niveau'
    });
    */

    // --- Contrôle de couches ---
    var baseMaps = {
      "Esri World Imagery": esriImagery,
      "openStreetMap": osm
    };

    var overlayMaps = {
      "Orthophoto": orthophoto,
      "DTM": dtm,
      "DSM": dsm,
    };

    L.control.layers(baseMaps, overlayMaps, {
      position: 'topright',
      collapsed: false
    }).addTo(map);

    // --- Petit encadré d'information dynamique (optionnel) ---
    var info = L.control({position: 'bottomleft'});

    info.onAdd = function () {
      this._div = L.DomUtil.create('div', 'info-box');
      this.update();
      return this._div;
    };

    info.update = function (zoom) {
      var z = zoom || map.getZoom();
      this._div.innerHTML =
        '<strong>Zoom : </strong>' + z +
        '<br><strong>Coordonnées : </strong><span id="coords">–</span>';
    };

    info.addTo(map);

    // Mise à jour du zoom
    map.on('zoomend', function () {
      info.update(map.getZoom());
    });

    // Affichage des coordonnées sous le curseur
    map.on('mousemove', function (e) {
      var lat = e.latlng.lat.toFixed(6);
      var lng = e.latlng.lng.toFixed(6);
      var coordsSpan = document.getElementById('coords');
      if (coordsSpan) {
        coordsSpan.textContent = lat + ', ' + lng;
      }
    });
  </script>
</body>
</html>
